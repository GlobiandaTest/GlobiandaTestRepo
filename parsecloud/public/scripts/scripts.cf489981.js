"use strict";Parse.initialize("VdnHbNNGjRWrRzYIdOlndzSBppkrOt3bySgdDfaB","CkGzTIsk7Eh6CFFsu5Ur31OSE14dEXcGSRAKbmjs"),window.fbAsyncInit=function(){Parse.FacebookUtils.init({appId:"1415345535439091",status:!0,cookie:!0,xfbml:!0,version:"v2.3"})},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk"),angular.module("test150327App",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",access:{needLogin:!1}}).when("/logout",{templateUrl:"views/logout.html",controller:"LogoutCtrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignupCtrl",access:{needLogin:!1}}).when("/protected",{templateUrl:"views/protected.html",controller:"ProtectedCtrl",access:{needLogin:!0}}).when("/resetpassword",{templateUrl:"views/resetpassword.html",controller:"ResetpasswordCtrl",access:{needLogin:!1}}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","auth",function(a,b,c){a.$on("$routeChangeStart",function(a,d){d.access&&!c.isLoggedIn()&&d.access.needLogin&&(c.setPreviousUrl(d.$$route.originalPath),b.path("/login")),d.access&&c.isLoggedIn()&&!d.access.needLogin&&b.path("/")})}]),angular.module("test150327App").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("test150327App").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("test150327App").controller("LoginCtrl",["$scope","auth","$location",function(a,b,c){a.error="",a.doLogin=function(){b.login(a.form.user,a.form.pass,{success:function(){d(),a.$apply()},error:function(b,c){a.error=c.message,a.$apply()}})},a.doLoginFb=function(){b.loginFb({successSignup:function(){d(),a.$apply()},successLogin:function(){d(),a.$apply()},error:function(b,c){a.error=c.message,a.$apply()}})};var d=function(){b.getPreviousUrl()?(c.path(b.getPreviousUrl()),b.clearPreviousUrl()):c.path("/")}}]),angular.module("test150327App").factory("auth",function(){var a,b=Parse.User.current();return{login:function(a,c,d){Parse.User.logIn(a,c,{success:function(a){b=Parse.User.current(),d.success&&d.success(a)},error:function(a,b){d.error&&d.error(a,b)}})},signUp:function(a,c,d,e,f){var g=new Parse.User;g.set("username",a),g.set("password",c),g.set("email",d),g.set("fullname",e),g.signUp(null,{success:function(a){b=Parse.User.current(),f.success&&f.success(a)},error:function(a,b){f.error&&f.error(a,b)}})},logout:function(a){Parse.User.logOut().then(function(){b=Parse.User.current(),a()})},loginFb:function(a){Parse.FacebookUtils.logIn("email",{success:function(c){c.existed()?(console.log("User logged in through Facebook!"),b=Parse.User.current(),a&&a.successLogin&&a.successLogin(c)):(console.log("User signed up and logged in through Facebook!"),FB.api("/me",function(d){c.set("fullname",d.name),c.set("email",d.email),console.log("casaperro = ",d),c.save(null,{success:function(c){b=Parse.User.current(),a&&a.successSignup&&a.successSignup(c)},error:function(a,b){alert("Failed to create new object, with error code: "+b.message)}})}))},error:function(b,c){console.log("User cancelled the Facebook login or did not fully authorize."),a&&a.error&&a.error(b,c)}})},isLoggedIn:function(){return b?!0:!1},getCurrentUser:function(){return b},setPreviousUrl:function(b){a=b},getPreviousUrl:function(){return a},clearPreviousUrl:function(){a=void 0},resetPassword:function(a,b){Parse.User.requestPasswordReset(a,{success:function(){b.success&&b.success()},error:function(a){b.error&&b.error(a)}})}}}),angular.module("test150327App").controller("LogoutCtrl",["$scope","$location","auth",function(a,b,c){c.logout(function(){b.path("/")})}]),angular.module("test150327App").controller("NavbarCtrl",["$scope","auth",function(a,b){a.isLoggedIn=b.isLoggedIn,a.getCurrentUser=b.getCurrentUser}]),angular.module("test150327App").controller("SignupCtrl",["$scope","auth","$location",function(a,b,c){a.error="",a.doSignUp=function(){b.signUp(a.form.user,a.form.pass,a.form.email,a.form.fullname,{success:function(){c.path("/"),a.$apply()},error:function(b,c){a.error=c.message,a.$apply()}})},a.doLoginFb=function(){b.loginFb({successSignup:function(){c.path("/"),a.$apply()},successLogin:function(){c.path("/"),a.$apply()},error:function(b,c){a.error=c.message,a.$apply()}})}}]),angular.module("test150327App").controller("ProtectedCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("test150327App").controller("ResetpasswordCtrl",["$scope","$location","auth",function(a,b,c){a.form={},a.resetpassword=function(){c.resetPassword(a.form.email,{success:function(){b.path("/login"),a.$apply()},error:function(b){a.error=b.message,a.$apply()}})}}]);